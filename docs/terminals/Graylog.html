

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Graylog &mdash; HHC2019  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Mongo Pilfer &lt;&gt;" href="MongoPilfer.html" />
    <link rel="prev" title="Nyanshell &lt;&gt;" href="Nyanshell.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> HHC2019
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Objectives:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../objectives/summary.html">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../objectives/question0.html">0) Talk to Santa in the Quad</a></li>
<li class="toctree-l1"><a class="reference internal" href="../objectives/question1.html">1) Find the Turtle Doves</a></li>
<li class="toctree-l1"><a class="reference internal" href="../objectives/question2.html">2) Unredact Threatening Document</a></li>
<li class="toctree-l1"><a class="reference internal" href="../objectives/question3.html">3) Windows Log Analysis: Evaluate Attack Outcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../objectives/question4.html">4) Windows Log Analysis: Determine Attacker Technique</a></li>
<li class="toctree-l1"><a class="reference internal" href="../objectives/question5.html">5) Network Log Analysis: Determine Compromised System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../objectives/question6.html">6) Splunk</a></li>
<li class="toctree-l1"><a class="reference internal" href="../objectives/question7.html">7) Get Access To The Steam Tunnels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../objectives/question8.html">8) Bypassing the Frido Sleigh CAPTEHA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../objectives/question9.html">9) Retrieve Scraps of Paper from Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../objectives/question10.html">10) Recover Cleartext Document</a></li>
<li class="toctree-l1"><a class="reference internal" href="../objectives/question11.html">11) Open the Sleigh Shop Door</a></li>
<li class="toctree-l1"><a class="reference internal" href="../objectives/question12.html">12) Filter Out Poisoned Sources of Weather Data</a></li>
</ul>
<p class="caption"><span class="caption-text">Terminals:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="EscapeEd.html">Escape Ed &lt;&gt;</a></li>
<li class="toctree-l1"><a class="reference internal" href="LinuxPath.html">Linux Path &lt;&gt;</a></li>
<li class="toctree-l1"><a class="reference internal" href="XmasCheerLaser.html">Xmas Cheer Laser &lt;&gt;</a></li>
<li class="toctree-l1"><a class="reference internal" href="FrostyKeypad.html">Frosty Keypad &lt;&gt;</a></li>
<li class="toctree-l1"><a class="reference internal" href="HolidayHackTrail.html">Holiday Hack Trail &lt;&gt;</a></li>
<li class="toctree-l1"><a class="reference internal" href="Nyanshell.html">Nyanshell &lt;&gt;</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Graylog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#question-1">Question 1:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#question-3">Question 3:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#question-4">Question 4:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#question-5">Question 5:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#question-6">Question 6:</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="MongoPilfer.html">Mongo Pilfer &lt;&gt;</a></li>
<li class="toctree-l1"><a class="reference internal" href="SmartBraces.html">Smart Braces</a></li>
<li class="toctree-l1"><a class="reference internal" href="ZeekJSONAnalysis.html">Zeek JSON Analysis &lt;&gt;</a></li>
</ul>
<p class="caption"><span class="caption-text">Appendices:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendices/narrative.html">Narrative</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">HHC2019</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Graylog</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1><a class="reference external" href="https://incident.elfu.org/?challenge=graylog">Graylog</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Click on the All messages Link to access the Graylog search interface!
Make sure you are searching in all messages!
The Elf U Graylog server has an integrated incident response reporting system. Just mouse-over the box in the lower-right corner.
Login with the username elfustudent and password elfustudent.
</pre></div>
</div>
<div class="section" id="question-1">
<h2>Question 1:<a class="headerlink" href="#question-1" title="Permalink to this headline">¶</a></h2>
<p>Minty CandyCane reported some weird activity on his computer after he clicked on a link in Firefox for a cookie recipe and downloaded a file.</p>
<p>What is the full-path + filename of the first malicious file downloaded by Minty?
Answer:
<strong>C:UsersmintyDownloadscookie_recipe.exe</strong></p>
<p>Query:
<code class="docutils literal notranslate"><span class="pre">EventID:2</span> <span class="pre">AND</span> <span class="pre">ProcessImage:/.+\firefox.exe/</span> <span class="pre">NOT</span> <span class="pre">TargetFilename:/.+\.temp/</span></code></p>
<p>Post-Answer Dialog:
We can find this searching for sysmon file creation event id 2 with a process named firefox.exe and not junk .temp files. We can use regular expressions to include or exclude patterns:
TargetFilename:/.+.pdf/</p>
<p>The file was accessed at 2019-11-19 05:28:33.000
Question 2:
———–
The malicious file downloaded and executed by Minty gave the attacker remote access to his machine. What was the ip:port the malicious file connected to first?</p>
<p>Answer:
<strong>192.168.247.175:4444</strong></p>
<p>Query:
We searched for records containing “cookie_recipe.exe” and containing a DestinationIp
<code class="docutils literal notranslate"><span class="pre">cookie_recipe.exe</span> <span class="pre">AND</span> <span class="pre">DestinationIp:/.+/</span></code></p>
<p>A better query might have been:
<code class="docutils literal notranslate"><span class="pre">ProcessImage:/.+cookie_recipe.exe/</span> <span class="pre">AND</span> <span class="pre">DestinationIp:/.+/</span></code></p>
<p>Post-Answer Dialog:
We can pivot off the answer to our first question using the binary path as our ProcessImage.</p>
</div>
<div class="section" id="question-3">
<h2>Question 3:<a class="headerlink" href="#question-3" title="Permalink to this headline">¶</a></h2>
<p>Question 3:
What was the first command executed by the attacker?
(answer is a single word)</p>
<p>Answer:
<strong>whoami</strong></p>
<p>Query:
ParentProcessImage:/.+cookie_recipe.exe/</p>
<p>Post-Answer Dialog:
Since all commands (sysmon event id 1) by the attacker are initially running through the cookie_recipe.exe binary, we can set its full-path as our ParentProcessImage to find child processes it creates sorting on timestamp.</p>
</div>
<div class="section" id="question-4">
<h2>Question 4:<a class="headerlink" href="#question-4" title="Permalink to this headline">¶</a></h2>
<p>What is the one-word service name the attacker used to escalate privileges?</p>
<p>Answer:
<strong>webexservice</strong></p>
<p>Query:
ParentProcessImage:/.+cookie_recipe.exe/
Our records are sorted according to timestamp, so we look at later commands until we see something involving a service. The command used was:
C:Windowssystem32cmd.exe /c “cmd.exe /c sc start webexservice a software-update 1 C:UsersmintyDownloadscookie_recipe2.exe “</p>
<p>Before this there were some commands passed to list services.</p>
<p>Post-Answer Dialog:
Continuing on using the cookie_reciper.exe binary as our ParentProcessImage, we should see some more commands later on related to a service.</p>
</div>
<div class="section" id="question-5">
<h2>Question 5:<a class="headerlink" href="#question-5" title="Permalink to this headline">¶</a></h2>
<p>What is the file-path + filename of the binary ran by the attacker to dump credentials?</p>
<p>Answer: C:cookie.exe</p>
<p>Query:
ParentProcessImage:/.+cookie_recipe2.exe/</p>
<p>The attacker downloads mimikatz.exe and saves it as C:cookie.exe</p>
<p>Post-Answer Dialog:
The attacker elevates privileges using the vulnerable webexservice to run a file called cookie_recipe2.exe. Let’s use this binary path in our ParentProcessImage search.</p>
</div>
<div class="section" id="question-6">
<h2>Question 6:<a class="headerlink" href="#question-6" title="Permalink to this headline">¶</a></h2>
<p>The attacker pivoted to another workstation using credentials gained from Minty’s computer. Which account name was used to pivot to another machine?</p>
<p>Windows Event Id 4624 is generated when a user network logon occurs successfully. We can also filter on the attacker’s IP using SourceNetworkAddress.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="MongoPilfer.html" class="btn btn-neutral float-right" title="Mongo Pilfer &lt;&gt;" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Nyanshell.html" class="btn btn-neutral float-left" title="Nyanshell &lt;&gt;" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Peter and Antonios Lapornik

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>