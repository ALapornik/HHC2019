

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6) Splunk &mdash; HHC2019  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7) Get Access To The Steam Tunnels" href="question7.html" />
    <link rel="prev" title="5) Network Log Analysis: Determine Compromised System" href="question5.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> HHC2019
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Objectives:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="summary.html">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="question0.html">0) Talk to Santa in the Quad</a></li>
<li class="toctree-l1"><a class="reference internal" href="question1.html">1) Find the Turtle Doves</a></li>
<li class="toctree-l1"><a class="reference internal" href="question2.html">2) Unredact Threatening Document</a></li>
<li class="toctree-l1"><a class="reference internal" href="question3.html">3) Windows Log Analysis: Evaluate Attack Outcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="question4.html">4) Windows Log Analysis: Determine Attacker Technique</a></li>
<li class="toctree-l1"><a class="reference internal" href="question5.html">5) Network Log Analysis: Determine Compromised System</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">6) Splunk</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#challenge">Challenge</a></li>
<li class="toctree-l2"><a class="reference internal" href="#answer">Answer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#challenge-question-answer">Challenge Question Answer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#training-questions-answers">Training Questions Answers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#solution">Solution</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#welcome-message">Welcome message</a></li>
<li class="toctree-l3"><a class="reference internal" href="#training-questions">Training Questions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#challenge-question">Challenge Question</a></li>
<li class="toctree-l3"><a class="reference internal" href="#additional-content">Additional Content</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#hint">Hint</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="question7.html">7) Get Access To The Steam Tunnels</a></li>
<li class="toctree-l1"><a class="reference internal" href="question8.html">8) Bypassing the Frido Sleigh CAPTEHA</a></li>
<li class="toctree-l1"><a class="reference internal" href="question9.html">9) Retrieve Scraps of Paper from Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="question10.html">10) Recover Cleartext Document</a></li>
<li class="toctree-l1"><a class="reference internal" href="question11.html">11) Open the Sleigh Shop Door</a></li>
<li class="toctree-l1"><a class="reference internal" href="question12.html">12) Filter Out Poisoned Sources of Weather Data</a></li>
</ul>
<p class="caption"><span class="caption-text">Terminals:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../terminals/EscapeEd.html">Escape Ed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terminals/LinuxPath.html">Linux Path</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terminals/XmasCheerLaser.html">Xmas Cheer Laser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terminals/FrostyKeypad.html">Frosty Keypad</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terminals/HolidayHackTrail.html">Holiday Hack Trail</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terminals/Nyanshell.html">Nyanshell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terminals/Graylog.html">Graylog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terminals/MongoPilfer.html">Mongo Pilfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terminals/SmartBraces.html">Smart Braces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terminals/ZeekJSONAnalysis.html">Zeek JSON Analysis</a></li>
</ul>
<p class="caption"><span class="caption-text">Appendices:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendices/narrative.html">Narrative</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/trivia.html">Trivia</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">HHC2019</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>6) Splunk</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="splunk">
<h1>6) Splunk<a class="headerlink" href="#splunk" title="Permalink to this headline">¶</a></h1>
<div class="section" id="challenge">
<h2>Challenge<a class="headerlink" href="#challenge" title="Permalink to this headline">¶</a></h2>
<p>Access <a class="reference external" href="https:/splunk.elfu.org/">https:/splunk.elfu.org/</a> as elf with password elfsocks. What was the message for Kent that the adversary embedded in this attack? The SOC folks at that link will help you along! For hints on achieving this objective, please visit the Laboratory in Hermey Hall and talk with Prof. Banas.</p>
</div>
<div class="section" id="answer">
<h2>Answer<a class="headerlink" href="#answer" title="Permalink to this headline">¶</a></h2>
<div class="section" id="challenge-question-answer">
<h3>Challenge Question Answer<a class="headerlink" href="#challenge-question-answer" title="Permalink to this headline">¶</a></h3>
<p>What was the message for Kent that the adversary embedded in this attack?</p>
<blockquote>
<div><p>Kent you are so unfair. And we were going to make you the king of the Winter Carnival.</p>
</div></blockquote>
</div>
<div class="section" id="training-questions-answers">
<h3>Training Questions Answers<a class="headerlink" href="#training-questions-answers" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>What is the short host name of Professor Banas’ computer?</p></li>
</ol>
<blockquote>
<div><p>sweetums</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>What is the name of the sensitive file that was likely accessed and copied by the attacker? Please provide the fully qualified location of the file. (Example: C:\temp\report.pdf)</p></li>
</ol>
<blockquote>
<div><p>C:\Users\cbanas\Documents\Naughty_and_Nice_2019_draft.txt</p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>What is the fully-qualified domain name(FQDN) of the command and control(C2) server? (Example: badguy.baddies.com)</p></li>
</ol>
<blockquote>
<div><p>144.202.46.214.vultr.com</p>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>What document is involved with launching the malicious PowerShell code? Please provide just the filename. (Example: results.txt)</p></li>
</ol>
<blockquote>
<div><p>19th Century Holiday Cheer Assignment.docm</p>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>How many unique email addresses were used to send Holiday Cheer essays to Professor Banas? Please provide the numeric value. (Example: 1)</p></li>
</ol>
<blockquote>
<div><p>21</p>
</div></blockquote>
<ol class="arabic simple" start="6">
<li><p>What was the password for the zip archive that contained the suspicious file?</p></li>
</ol>
<blockquote>
<div><p>123456789</p>
</div></blockquote>
<ol class="arabic simple" start="7">
<li><p>What email address did the suspicious file come from?</p></li>
</ol>
<blockquote>
<div><p><a class="reference external" href="mailto:bradly&#46;buttercups&#37;&#52;&#48;eifu&#46;org">bradly<span>&#46;</span>buttercups<span>&#64;</span>eifu<span>&#46;</span>org</a></p>
</div></blockquote>
</div>
</div>
<div class="section" id="solution">
<h2>Solution<a class="headerlink" href="#solution" title="Permalink to this headline">¶</a></h2>
<p>Logon to splunk using the following credentials:</p>
<p>Username: <code class="docutils literal notranslate"><span class="pre">elf</span></code>   Password: <code class="docutils literal notranslate"><span class="pre">********</span></code> <a class="footnote-reference brackets" href="#id3" id="id1">1</a></p>
<div class="section" id="welcome-message">
<h3>Welcome message<a class="headerlink" href="#welcome-message" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p><strong>The Search for Holiday Cheer Challenge</strong></p>
<ol class="arabic simple">
<li><p>Your goal is to answer the Challenge Question. You will include the answer to this question in your HHC write-up!</p></li>
<li><p>You do not need to answer the training questions. You may simply search through the Elf U SOC data to find the answer to the final question on your own.</p></li>
<li><p>If you need some guidance, answer the training questions! Each one will help you get closer to the answering the Challenge Question.</p></li>
<li><p>Characters in the SOC Secure Chat are there to help you. If you see a blinking red dot next to a character, click on them and read the chat history to learn what they have to teach you! And don’t forget to scroll up in the chat history!</p></li>
<li><p>To search the SOC data, just click the Search link in the navigation bar in the upper left hand corner of the page.</p></li>
<li><p>This challenge is best enjoyed on a laptop or desktop computer with screen width of 1600 pixels or more.</p></li>
<li><p><strong>WARNING</strong> This is a defensive challenge. Do not attack this system, web application, or back-end APIs. Thank you!</p></li>
</ol>
</div></blockquote>
</div>
<div class="section" id="training-questions">
<h3>Training Questions<a class="headerlink" href="#training-questions" title="Permalink to this headline">¶</a></h3>
<pre class="literal-block"><strong>Kent</strong>

<strong>Guest (me) :</strong> Hi Kent :-)
<strong>Kent :</strong> Hi yourself.
<strong>Guest (me) :</strong> I ran into Professor Banas. He said you contacted him about his computer being hacked?
<strong>Kent :</strong> Oh, well lots of analysts try to make it here in the ELF U SOC, but most of them crack under the pressure
<strong>Guest (me) :</strong> Well, can I help?
<strong>Kent :</strong> You can try. Go check out #ELFU SOC. Maybe someone there will have time to bring you up to speed. Here's a tip, click on those blinking red dots to the left column and read very carefully.
<strong>Guest (me) :</strong> Thanks???</pre>
<pre class="literal-block"><strong>#ELFU SOC</strong>

<strong>Cosmo Jingleberg :</strong> Hey did you all see that beaconing detection from RITA?
<strong>Zippy Frostington :</strong> Yep. And we have some system called '<strong>sweetums</strong>' here on campus communicating with the same weird IP
<strong>Alice Bluebird :</strong> Gah... that's Professor Banas' system from over in the Polar Studies department
<strong>Guest (me) :</strong> That's why I'm here, actually...Kent sent me to this channel to help with Prof. Banas' system
<strong>Alice Bluebird :</strong> smh...I'll DM you</pre>
<pre class="literal-block"><strong>Alice Bluebird</strong>

<strong>Alice Bluebird :</strong> hey hey...
<strong>Guest (me) :</strong> Hiya Alice
<strong>Alice Bluebird :</strong> I see you've met Kent
<strong>Guest (me) :</strong> briefly. He seems...frustrated
<strong>Alice Bluebird :</strong> Pretty accurate. He's been here a long time and he struts around like some sort of cyber-peacock
<strong>Alice Bluebird :</strong> Some time (preferably over good eggnog) I'll tell you about his horrible opsec, too
<strong>Alice Bluebird :</strong> Suffice to say we have adversaries poking fun at him during attacks. JML
<strong>Guest (me) :</strong> JML?
<strong>Alice Bluebird :</strong> jingle my life
<strong>Guest (me) :</strong> LOL!
<strong>Alice Bluebird :</strong> So Cosmo, Zippy, and I have a good handle on what went down with Professor B's system
<strong>Guest (me) :</strong> ah, gotcha
<strong>Alice Bluebird :</strong> But we can always use good analysts here in the SOC, so if you can figure it out, we'll put in a good word with the boss of the SOC.
<strong>Guest (me) :</strong> Let's do this!
<strong>Alice Bluebird :</strong> Okay. Your goal is to find the message for Kent that the adversary embedded in this attack.
<strong>Alice Bluebird :</strong> If you think you have the chops for that, don't let me slow you down. Get searching and enter the Challenge Question answer when you've found it.
<strong>Alice Bluebird :</strong> You'll need to know some things, though:
    1. We use Splunk, so click <a class="reference external" href="https://splunk.elfu.org/en-US/app/SA-elfusoc/search">here</a> or hit the Search link in the navigation up above to get started.
    2. I copied some raw files <a class="reference external" href="http://elfu-soc.s3-website-us-east-1.amazonaws.com/">here</a> or click the File Archive link in the navigation. (You'll find some references to the File Archive contents in Splunk)
    <strong>You'll need to use both of these resources to answer the Challenge Question!</strong>
<strong>Alice Bluebird :</strong> Don't worry though, I can get you started down the right path with a few hints if you need 'em. All you have to do is answer the first training question. If you've read all the chat windows here, you already have the answer ;-)</pre>
<p><strong>Training Question 1 Answer:</strong> In #ELFU SOC we found out that <strong>sweetums</strong> was the name of Prof. Banas’ system.</p>
<hr class="docutils" />
<pre class="literal-block"><strong>Alice Bluebird</strong>

<strong>Training BOT : Training Question 1 Answered Correctly</strong>
<strong>Guest (me) :</strong> Boom, first one done.
<strong>Alice Bluebird :</strong> Oh good, you read the #ELFU SOC chat :-)
<strong>Alice Bluebird :</strong> I jest :-) Okay check out the next question. You'll need to actually search for the answer this time.
<strong>Alice Bluebird :</strong> You may not know this, but Professor Banas is pretty close to the big guy.
<strong>Guest (me) :</strong> Santa?
<strong>Alice Bluebird :</strong> Yep. This is why we keep detailed logs from Professor B's machine
<strong>Guest (me) :</strong> I didn't know Banas was inner-circle... But then again, why would I know that?
<strong>Alice Bluebird :</strong> Well he is and the adversaries know it. They are always attacking him and the Elf U network trying to get to Santa.
<strong>Alice Bluebird :</strong> Our very first worry was they may have found some of Santa's sensitive data.
<strong>Guest (me) :</strong> Did they?
<strong>Alice Bluebird :</strong> That's what you need to tell me!
<strong>Alice Bluebird :</strong> I'll give you a tip. Sometimes simpler is better. If you have a word that you are really interested in, just start searching for it. Here is an example of searching for <cite>the professor's username &lt;https://splunk.elfu.org/en-US/app/SA-elfusoc/search?q=search%20index%3Dmain%20cbanas&amp;display.page.search.mode=smart&amp;dispatch.sample_ratio=1&amp;earliest=0&amp;latest=now&amp;display.general.type=events&amp;display.page.search.tab=events&gt;</cite>
<strong>Alice Bluebird :</strong> It's not a very precise search technique, but it can provide context and get you started.
<strong>Guest (me) :</strong> nods
<strong>Alice Bluebird :</strong> Use that technique (with a different search term) to answer question 2.
<strong>Guest (me) :</strong> I'm struggling with what to search for. Maybe I should search for &quot;sweetums&quot;
<strong>Alice Bluebird :</strong> Well, I just told you who we were most worried about protecting. Maybe start with his name! Also, sweetums is a good thought, but this is a training exercise and pretty much all the data pertains to that one host already so just searching for that may not get you far.</pre>
<p><strong>Training Question 2 Answer:</strong> After viewing the linked query (<code class="docutils literal notranslate"><span class="pre">index=main</span> <span class="pre">cbanas</span></code>), we tried using <code class="docutils literal notranslate"><span class="pre">index=main</span> <span class="pre">santa</span></code>. We found that the sensitive file path was: <strong>C:\Users\cbanas\Documents\Naughty_and_Nice_2019_draft.txt</strong></p>
<img alt="../_images/tq2.PNG" src="../_images/tq2.PNG" />
<hr class="docutils" />
<pre class="literal-block"><strong>Alice Bluebird</strong>

<strong>Training BOT : Training Question 2 Answered Correctly</strong>
<strong>Alice Bluebird :</strong> Okay that was a good warmup. FYI, Here's <a class="reference external" href="https://splunk.elfu.org/en-US/app/SA-elfusoc/search?q=search%20index%3Dmain%20santa&amp;display.page.search.mode=smart&amp;dispatch.sample_ratio=1&amp;earliest=0&amp;latest=now&amp;display.general.type=events&amp;display.page.search.tab=events">the search I'd have used for that last one</a>.
<strong>Alice Bluebird :</strong> Why he had a draft copy of this year's naughty and nice list sitting on his PC, I'll never know.
<strong>Alice Bluebird :</strong> Did you see the download of the scanning tool, too? That's interesting, but let's stay on task here.
<strong>Guest (me) :</strong> That was pretty easy...
<strong>Alice Bluebird :</strong> Well, you'll need to do a lot more than super-grep for Santa Claus to work in this SOC.
<strong>Guest (me) :</strong> haha understood
<strong>Alice Bluebird :</strong> You probably noticed right away that the attack used PowerShell. I need you to tell me the fully qualified domain name (FQDN) used for command and control.
<strong>Alice Bluebird :</strong> Use Microsoft Sysmon data to answer this question. Here's some <a class="reference external" href="https://www.splunk.com/en_us/blog/security/a-salacious-soliloquy-on-sysmon.html">background on Sysmon</a> if you need it.
<strong>Alice Bluebird :</strong> To search Sysmon data in our system, start by specifying the sourcetype using a search like <a class="reference external" href="https://splunk.elfu.org/en-US/app/SA-elfusoc/search?q=search%20index%3Dmain%20sourcetype%3DXmlWinEventLog%3AMicrosoft-Windows-Sysmon%2FOperational&amp;display.page.search.mode=smart&amp;dispatch.sample_ratio=1&amp;earliest=0&amp;latest=now&amp;display.general.type=events&amp;display.page.search.tab=events">sourcetype=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational</a>
<strong>Alice Bluebird :</strong> In Sysmon, Event Code 3 represents network connections and you can narrow your search by adding the term 'powershell'. There is an implied boolean AND operator between any search terms that you add. Try to narrow your search to include these terms.
<strong>Alice Bluebird :</strong> Your search should look something like this <a class="reference external" href="https://splunk.elfu.org/en-US/app/SA-elfusoc/search?q=search%20index%3Dmain%20sourcetype%3DXmlWinEventLog%3AMicrosoft-Windows-Sysmon%2FOperational%20powershell%20EventCode%3D3&amp;display.page.search.mode=smart&amp;dispatch.sample_ratio=1&amp;earliest=0&amp;latest=now&amp;display.general.type=events&amp;display.page.search.tab=events">sourcetype=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational powershell EventCode=3</a>
<strong>Alice Bluebird :</strong> Look through the lists of <strong>Interesting Fields</strong> and <strong>Selected Fields</strong> in the left-hand column of the search window. You should find what you are looking for there.</pre>
<p><strong>Training Question 3 Answer:</strong> Using the provided query (<code class="docutils literal notranslate"><span class="pre">index=main</span> <span class="pre">sourcetype=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational</span> <span class="pre">powershell</span> <span class="pre">EventCode=3</span></code>), click on either:
<code class="docutils literal notranslate"><span class="pre">DestinationHostname</span></code> in Selected Fields or <code class="docutils literal notranslate"><span class="pre">dest</span></code> or <code class="docutils literal notranslate"><span class="pre">dest_host</span></code> in Interesting Fields to find the FDQN under Value: <strong>144.202.46.214.vultr.com</strong></p>
<img alt="../_images/tq3.PNG" src="../_images/tq3.PNG" />
<hr class="docutils" />
<pre class="literal-block"><strong>Alice Bluebird</strong>

<strong>Training BOT : Training Question 3 Answered Correctly</strong>
<strong>Alice Bluebird :</strong> Well done.
<strong>Guest (me) :</strong> Thanks
<strong>Alice Bluebird :</strong> Let's investigate where all this PowerShell originated. You should start by running <a class="reference external" href="https://splunk.elfu.org/en-US/app/SA-elfusoc/search?q=search%20index%3Dmain%20sourcetype%3D%22WinEventLog%3AMicrosoft-Windows-Powershell%2FOperational%22&amp;display.page.search.mode=smart&amp;dispatch.sample_ratio=1&amp;earliest=0&amp;latest=now&amp;display.general.type=events&amp;display.page.search.tab=events">this search</a> to view all the PowerShell logs on the system.
<strong>Guest (me) :</strong> Searching now. What am I looking for?
<strong>Alice Bluebird :</strong> We'd like to determine the process ID or process GUID associated with these PowerShell logs, but that information is not included in the events we have.
<strong>Guest (me) :</strong> Ah, dead-end then?
<strong>Alice Bluebird :</strong> Goodness no! We just need to pivot.
<strong>Guest (me) :</strong> On what though?
<strong>Alice Bluebird :</strong> We can pivot on...time.
<strong>Guest (me) :</strong> whoa...
<strong>Alice Bluebird :</strong> First off, flip the results of that last search so the oldest event is at the top of the list <a class="reference external" href="https://splunk.elfu.org/en-US/app/SA-elfusoc/search?q=search%20index%3Dmain%20sourcetype%3D%22WinEventLog%3AMicrosoft-Windows-Powershell%2FOperational%22%20%7C%20reverse&amp;display.page.search.mode=smart&amp;dispatch.sample_ratio=1&amp;earliest=0&amp;latest=now&amp;display.general.type=events&amp;display.page.search.tab=events">by adding | reverse to the end</a>
<strong>Guest (me) :</strong> pipe reverse. That's handy.
<strong>Alice Bluebird :</strong> Indeed. Okay, this is where we pivot...
<strong>Alice Bluebird :</strong> Look at the <strong>Time</strong> column in your search results. If you click on the date/timestamp from that first event, you can specify a time window. Accept the default of +/- five seconds and click apply. Then remove the <strong>sourcetype</strong> search term and also remove the <strong>'| reverse'</strong> and re-run the search.
<strong>Guest (me) :</strong> Well now I see lots of different types of events from that ten-second window.
<strong>Alice Bluebird :</strong> Try to find a process ID of interest. Sysmon events are good for that. You should be able to find two different process IDs from Sysmon events in that time window...
<strong>Alice Bluebird :</strong> You need to uncover what launched those processes. If Sysmon Event Code 1 results are not available, try looking for Windows Process Execution events (Event ID 4688). A search to get you started with 4688 logs is <a class="reference external" href="https://splunk.elfu.org/en-US/app/SA-elfusoc/search?q=search%20index%3Dmain%20sourcetype%3DWinEventLog%20EventCode%3D4688&amp;display.page.search.mode=smart&amp;dispatch.sample_ratio=1&amp;earliest=0&amp;latest=&amp;display.general.type=events&amp;display.page.search.tab=events&amp;display.events.fields=%5B">sourcetype=WinEventLog EventCode=4688</a>
<strong>Alice Bluebird :</strong> Keep in mind that 4688 events record process IDs in hexadecimal, so you may need to do some conversion. Remember you should have a couple of process IDs that are interesting. Convert them to hex and search away in the 4688 events. Oh and at this point (when you are searching for 4688 events) go ahead and set your time window back to all time so you don't miss anything.
<strong>Guest (me) :</strong> Uhh, this one is pretty difficult.
<strong>Alice Bluebird :</strong> Yep, if the above is not clear, you may want to check out a KringleCon 2 talk by James Brodsky that covers this topic in detail.
<strong>Alice Bluebird :</strong> You're looking for a &quot;document&quot; that appears to be involved with kicking off all this PowerShell.</pre>
<p><strong>Training Question 4 Answer:</strong> Using the given query (<code class="docutils literal notranslate"><span class="pre">index=main</span> <span class="pre">sourcetype=&quot;WinEventLog:Microsoft-Windows-Powershell/Operational&quot;</span> <span class="pre">|</span> <span class="pre">reverse</span></code>) and click on the first time value.</p>
<img alt="../_images/tq4a.PNG" src="../_images/tq4a.PNG" />
<p>Then, set the span to +/- 5 seconds.</p>
<img alt="../_images/tq4b.PNG" src="../_images/tq4b.PNG" />
<p>Edit the query to <code class="docutils literal notranslate"><span class="pre">index=main</span></code></p>
<p>Find the <code class="docutils literal notranslate"><span class="pre">ProcessId</span></code> field</p>
<img alt="../_images/tq4c.PNG" src="../_images/tq4c.PNG" />
<p>Set Time to AllTime</p>
<p>Search for the found PID (converted to hex)</p>
<p>Use the Queries:</p>
<p><code class="docutils literal notranslate"><span class="pre">index=main</span> <span class="pre">sourcetype=WinEventLog</span> <span class="pre">EventCode=4688</span> <span class="pre">process_id=0x187c</span> <span class="pre">*doc*</span></code></p>
<p>and</p>
<p><code class="docutils literal notranslate"><span class="pre">index=main</span> <span class="pre">sourcetype=WinEventLog</span> <span class="pre">EventCode=4688</span> <span class="pre">process_id=0x16e8</span> <span class="pre">*doc*</span></code></p>
<p>to find the document path.</p>
<p>The answer can be found in the <code class="docutils literal notranslate"><span class="pre">Body</span></code> and in <code class="docutils literal notranslate"><span class="pre">Process_Command_Line</span></code> as the last part of the path.</p>
<p>The answer is <strong>19th Century Holiday Cheer Assignment.docm</strong></p>
<hr class="docutils" />
<pre class="literal-block"><strong>Alice Bluebird</strong>

<strong>Training BOT : Training Question 4 Answered Correctly</strong>
<strong>Alice Bluebird :</strong> Good job. Malicious Word doc...
<strong>Guest (me) :</strong> yeah...So you want me to find out where it came from?
<strong>Alice Bluebird :</strong> Yes. You've heard of stoQ right?
<strong>Guest (me) :</strong> umm....
<strong>Alice Bluebird :</strong> Well, it's the coolest open source security tool you've probably never heard of.
<strong>Alice Bluebird :</strong> It's an automation framework that we use to analyze all email messages at Elf U. Check out <a class="reference external" href="https://stoq.punchcyber.com/">the stoQ project home page</a>. Oh and here are slides from a <a class="reference external" href="https://www.sans.org/cyber-security-summit/archives/file/summit_archive_1492181136.pdf">talk on stoQ</a> from the SANS DFIR Summit a few years back.
<strong>Guest (me) :</strong> neat!
<strong>Alice Bluebird :</strong> stoQ output is in JSON format, and we store that in our log management platform. It allows you to run <a class="reference external" href="https://splunk.elfu.org/en-US/app/SA-elfusoc/search?q=search%20index%3Dmain%20sourcetype%3Dstoq%20%7C%20table%20_time%20results%7B%7D.workers.smtp.to%20results%7B%7D.workers.smtp.from%20%20results%7B%7D.workers.smtp.subject%20results%7B%7D.workers.smtp.body%20%7C%20sort%20-%20_time&amp;display.page.search.mode=smart&amp;dispatch.sample_ratio=1&amp;earliest=0&amp;latest=&amp;display.general.type=statistics&amp;display.page.search.tab=statistics&amp;display.events.fields=%5B">powerful searches like this one</a>. Check out those strange-looking field names like <strong>results{}.workers.smtp.subject</strong>. That's how JSON data looks in our search system, and stoQ events are made up of some fairly deeply nested JSON. Just keep that in mind.
<strong>Alice Bluebird :</strong> Okay, time for you to play around with that search and answer the question. You should be aware that Professor Banas was very clear in his instructions to his students: All assignment submissions must be made via email and <strong>must</strong> have the subject 'Holiday Cheer Assignment Submission'. Remember email addresses are not case sensitive so don't double-count them!</pre>
<p><strong>Training Question 5 Answer:</strong> Edit the given query to search for the subject “Holiday Cheer Assignment”. The answer is the number of results, and can be seen in brackets next to statistics.</p>
<p>The query we used was <code class="docutils literal notranslate"><span class="pre">index=main</span> <span class="pre">sourcetype=stoq</span>&#160; <span class="pre">results{}.workers.smtp.subject=&quot;Holiday</span> <span class="pre">Cheer</span> <span class="pre">Assignment</span> <span class="pre">Submission&quot;</span> <span class="pre">|</span> <span class="pre">table</span> <span class="pre">_time</span> <span class="pre">results{}.workers.smtp.to</span> <span class="pre">results{}.workers.smtp.from</span>&#160; <span class="pre">results{}.workers.smtp.subject</span> <span class="pre">results{}.workers.smtp.body</span> <span class="pre">|</span> <span class="pre">sort</span> <span class="pre">-</span> <span class="pre">_time</span></code></p>
<img alt="../_images/tq5.PNG" src="../_images/tq5.PNG" />
<p>In this case, there are <strong>21</strong> results.</p>
<hr class="docutils" />
<pre class="literal-block"><strong>Alice Bluebird</strong>

<strong>TrainingBOT : Training Question 5 Answered Correctly</strong>
<strong>Alice Bluebird :</strong> Nice, you are getting the hang of this.
<strong>Guest (me) :</strong> It's fun!
<strong>Alice Bluebird :</strong> The attacker used MITRE ATT&amp;CK Technique 1193 in their attack on Professor Banas.
<strong>Guest (me) :</strong> mmmmm hmmmm
<strong>Alice Bluebird :</strong> This one should be easy for you. Just use what you already know about the suspicious file name you identified, and about the type of visibility that stoQ gives you...</pre>
<p><strong>Training Question 6 Answer:</strong> Although the same query can be used, It’s easy to search for the password. Just use the following query:
<code class="docutils literal notranslate"><span class="pre">index=main</span> <span class="pre">sourcetype=stoq</span>&#160; <span class="pre">results{}.workers.smtp.body=&quot;*password*&quot;</span> <span class="pre">|</span> <span class="pre">table</span>&#160; <span class="pre">results{}.workers.smtp.body</span> <span class="pre">|</span> <span class="pre">sort</span> <span class="pre">-</span> <span class="pre">_time</span></code></p>
<img alt="../_images/tq6.PNG" src="../_images/tq6.PNG" />
<p>The password is <strong>123456789</strong> as seen in the message.</p>
<hr class="docutils" />
<pre class="literal-block"><strong>Alice Bluebird</strong>

<strong>TrainingBOT : Training Question 6 Answered Correctly</strong>
<strong>Alice Bluebird :</strong> Good.
<strong>Guest (me) :</strong> Can stoQ deal with password-protected zip attachments like that one?
<strong>Alice Bluebird :</strong> It can! It tries a list of common passwords, and the attacker chose one that was on the list.
<strong>Guest (me) :</strong> Sweet
<strong>Alice Bluebird :</strong> Here's another easy one for you...</pre>
<p><strong>Training Question 7 Answer:</strong> For this question, just edit the previous query to output the <code class="docutils literal notranslate"><span class="pre">from</span></code> field. The email <strong>bradly.buttercups&#64;eifu.org</strong> is found. Notice that the domain is eifu.org, not elfu.org</p>
<img alt="../_images/tq7.PNG" src="../_images/tq7.PNG" />
</div>
<div class="section" id="challenge-question">
<h3>Challenge Question<a class="headerlink" href="#challenge-question" title="Permalink to this headline">¶</a></h3>
<pre class="literal-block"><strong>Alice Bluebird</strong>

<strong>Training BOT : Training Question 7 Answered Correctly</strong>
<strong>Alice Bluebird :</strong> Well, now you are ready to find the message that the attacker embedded for our friend Kent.
<strong>Alice Bluebird :</strong> Kent missed it, which is not surprising, but Zippy noticed a funny (yet terrifying) message in the properties of the malicious document.
<strong>Guest (me) :</strong> Hmmm. I was going to start looking through the macros.
<strong>Alice Bluebird :</strong> Look, I was not about to put the actual malicious executable content into this training exercise.
<strong>Guest (me) :</strong> Oh, understood. I will dig for properties.
<strong>Alice Bluebird :</strong> Remember I provided you with a <a class="reference external" href="http://elfu-soc.s3-website-us-east-1.amazonaws.com/">File Archive</a>. stoQ puts metadata into the log management platform, but it stores the raw artifacts in their entirety in the archive. Use the stoQ events in the search platform to guide your search through the File Archive.
<strong>Alice Bluebird :</strong> <a class="reference external" href="https://splunk.elfu.org/en-US/app/SA-elfusoc/search?q=search%20index%3Dmain%20sourcetype%3Dstoq%20%20%22results%7B%7D.workers.smtp.from%22%3D%22bradly%20buttercups%20%3Cbradly.buttercups%40eifu.org%3E%22&amp;display.page.search.mode=smart&amp;dispatch.sample_ratio=1&amp;earliest=0&amp;latest=&amp;display.general.type=events&amp;display.page.search.tab=events&amp;display.events.fields=%5B">Start with this stoQ event</a>
<strong>Alice Bluebird :</strong> Look in the 'results' array. Each element contains the name of the file that stoQ extracted in the 'results-&gt;payload_meta-&gt;extra_data-&gt;filename' field. And when you find one of interest, use the associated 'results-&gt;archivers-&gt;filedir-&gt;path' field to guide you through the File Archive.
<strong>Guest (me) :</strong> Uhhh okay. But that JSON event is a beast. So many 'results'!
<strong>Alice Bluebird :</strong> Yeah but you can use it to your advantage with the Splunk spath command. Add this to the end of that last search I provided.
    | eval results = spath(_raw, &quot;results{}&quot;)
    | mvexpand results
    | eval path=spath(results, &quot;archivers.filedir.path&quot;), filename=spath(results, &quot;payload_meta.extra_data.filename&quot;), fullpath=path.&quot;/&quot;.filename
    | search fullpath!=&quot;&quot;
    | table filename,fullpath
<strong>Alice Bluebird :</strong> Last thing for you today: Did you know that modern Word documents are (at their <strong>core</strong>) nothing more than a bunch of .xml files?
<strong>Guest (me) :</strong> haha! I'm on it.</pre>
<p>Using the provided query:</p>
<blockquote>
<div><p>index=main sourcetype=stoq  “results{}.workers.smtp.from”=”bradly buttercups &lt;<a class="reference external" href="mailto:bradly&#46;buttercups&#37;&#52;&#48;eifu&#46;org">bradly<span>&#46;</span>buttercups<span>&#64;</span>eifu<span>&#46;</span>org</a>&gt;” | eval results = spath(_raw, “results{}”)
| mvexpand results
| eval path=spath(results, “archivers.filedir.path”), filename=spath(results, “payload_meta.extra_data.filename”), fullpath=path.”/”.filename
| search filename=”core.xml”
| table filename,fullpath</p>
</div></blockquote>
<p>We can find the address of core.xml in the archive</p>
<img alt="../_images/challenge-search.PNG" src="../_images/challenge-search.PNG" />
<p>Find the file in the archive, download and open it in notepad</p>
<img alt="../_images/Archive.PNG" src="../_images/Archive.PNG" />
<p>Content:</p>
<blockquote>
<div><p>&lt;?xml version=”1.0” encoding=”UTF-8” standalone=”yes”?&gt;
&lt;cp:coreProperties xmlns:cp=”http://schemas.openxmlformats.org/package/2006/metadata/core-properties” xmlns:dc=”http://purl.org/dc/elements/1.1/” xmlns:dcterms=”http://purl.org/dc/terms/” xmlns:dcmitype=”http://purl.org/dc/dcmitype/” xmlns:xsi=”http://www.w3.org/2001/XMLSchema-instance”&gt;&lt;dc:title&gt;Holiday Cheer Assignment&lt;/dc:title&gt;&lt;dc:subject&gt;19th Century Cheer&lt;/dc:subject&gt;&lt;dc:creator&gt;Bradly Buttercups&lt;/dc:creator&gt;&lt;cp:keywords&gt;&lt;/cp:keywords&gt;&lt;dc:description&gt;Kent you are so unfair. And we were going to make you the king of the Winter Carnival.&lt;/dc:description&gt;&lt;cp:lastModifiedBy&gt;Tim Edwards&lt;/cp:lastModifiedBy&gt;&lt;cp:revision&gt;4&lt;/cp:revision&gt;&lt;dcterms:created xsi:type=”dcterms:W3CDTF”&gt;2019-11-19T14:54:00Z&lt;/dcterms:created&gt;&lt;dcterms:modified xsi:type=”dcterms:W3CDTF”&gt;2019-11-19T17:50:00Z&lt;/dcterms:modified&gt;&lt;cp:category&gt;&lt;/cp:category&gt;&lt;/cp:coreProperties&gt;</p>
</div></blockquote>
<p><strong>Challenge Question Answer:</strong> <strong>Kent you are so unfair. And we were going to make you the king of the Winter Carnival.</strong></p>
</div>
<div class="section" id="additional-content">
<h3>Additional Content<a class="headerlink" href="#additional-content" title="Permalink to this headline">¶</a></h3>
<p>After the Main Challenge is solved, some more messages appear</p>
<pre class="literal-block"><strong>Alice Bluebird</strong>

<strong>Training BOT : CHALLENGE QUESTION Answered Correctly</strong>
<strong>Alice Bluebird :</strong> Oh nice job on the challenge question!
<strong>Guest (me) :</strong> Thx! And thanks for all the help :-)
<strong>Alice Bluebird :</strong> No worries. Steep learning curve around here.
<strong>Alice Bluebird :</strong> I'll put in a good word for you with the boss of the SOC.
<strong>Alice Bluebird :</strong> and feel free to poke around more. There's fun stuff in the data that I did not guide you to.
<strong>Guest (me) :</strong> Oh cool I may do that...but do you think it's getting too weird around here?
<strong>Alice Bluebird :</strong> Absolutely</pre>
<pre class="literal-block"><strong>Kent</strong>

<strong>Guest (me) :</strong> Oh man that's pretty embarrassing, eh?
<strong>Kent :</strong> Oh you again?
<strong>Guest (me) :</strong> lulz...
    Kent you are so unfair. And we were going to make you the king of the Winter Carnival.
<strong>Kent :</strong> You'll rue the day.
<strong>Guest (me) :</strong> Who talks like that?</pre>
<p>Message:</p>
<blockquote>
<div><p>Congratulations!
You found the message from the attacker. Be sure to record it somewhere safe for your writeup! Oh, and feel free to poke around here as long as you’d like!</p>
</div></blockquote>
</div>
</div>
<div class="section" id="hint">
<h2>Hint<a class="headerlink" href="#hint" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt><strong>Professor Banas:</strong></dt><dd><p>Hi, I’m Dr. Banas, professor of Cheerology at Elf University.
This term, I’m teaching “HOL 404: The Search for Holiday Cheer in Popular Culture,” and I’ve had quite a shock!
I was at home enjoying a nice cup of Gløgg when I had a call from Kent, one of my students who interns at the Elf U SOC.
Kent said that my computer has been hacking other computers on campus and that I needed to fix it ASAP!
If I don’t, he will have to report the incident to the boss of the SOC.
Apparently, I can find out more information from this website <a class="reference external" href="https://splunk.elfu.org/">https://splunk.elfu.org/</a> with the username: elf / Password: elfsocks.
I don’t know anything about computer security. Can you please help me?</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>No hint is given by Prof Banas. However, Alice Bluebird guides you through the challenge once you log on.</p>
</div>
<p class="rubric">Footnotes</p>
<dl class="footnote brackets">
<dt class="label" id="id3"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>elfsocks</p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="question7.html" class="btn btn-neutral float-right" title="7) Get Access To The Steam Tunnels" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="question5.html" class="btn btn-neutral float-left" title="5) Network Log Analysis: Determine Compromised System" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Peter and Antonios Lapornik

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>